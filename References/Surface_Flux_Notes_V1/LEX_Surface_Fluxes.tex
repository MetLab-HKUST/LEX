\documentclass[a4paper,11pt]{article}

\usepackage[left=2.5cm,top=2.5cm,right=2.5cm,bottom=2.5cm]{geometry}
\usepackage{graphicx}
\usepackage[font=footnotesize,labelfont=bf]{caption}
\usepackage{enumitem}
\usepackage{xcolor}
\usepackage{algorithm2e}

%\usepackage{amsmath,amsthm} 
%\usepackage{newtxtext}
%\usepackage{newtxmath}
% 
% \usepackage[p,osf]{scholax}
% T1 and textcomp are loaded by package. Change that here, if you want
% load sans and typewriter packages here, if needed
% \usepackage{amsmath,amsthm}% must be loaded before newtxmath
% amssymb should not be loaded
% \usepackage[scaled=1.075,ncf,vvarbb]{newtxmath}% need to scale up math package
% vvarbb selects the STIX version of blackboard bold.

% \usepackage[T1]{fontenc}
% \usepackage{stix}

\usepackage{kpfonts}
\usepackage[T1]{fontenc}

% 
% \usepackage{libertinus}
% \usepackage[T1]{fontenc}
% \renewcommand*\familydefault{\sfdefault} %% Only if the base font of the document is to be sans serif

\setlength{\parskip}{3ex}
\setlength{\parindent}{1.5em}
\renewcommand{\baselinestretch}{1.5}

\usepackage{amsmath,amsthm}
\usepackage[most]{tcolorbox}

\tcbset{colback=yellow!10!white, colframe=red!50!black, 
        highlight math style= {enhanced, %<-- needed for the ’remember’ options
            colframe=red,colback=red!10!white,boxsep=0pt}
        }
        

% Title Page
\title{\textbf{LEX Surface Flux Scheme}}
\author{Xiaoming Shi}

\begin{document}
\maketitle

The simplest option for surface fluxes would be to prescribe them directly or prescribe transfer (drag) coefficients. However, we also implemented the bulk surface exchange formulation of CAM6 (Neale et al., 2010). In this scheme, the bulk formulas to determine the turbulent fluxes of momentum (stress), water (evaporation, or latent heat), and sensible heat from the atmosphere into the ocean surfaces (i.e., positive direction is downward) are 
\begin{align}
\tau &= \rho_A |\Delta \mathbf{u}_h| C_D\Delta \mathbf{u}_h \\
E &= \rho_A|\Delta \mathbf{u}_h| C_E\Delta q \\
H &= \rho_A|\Delta \mathbf{u}_h|C_p C_H\Delta \theta
\end{align}
where $\rho_A$ is the atmospheric surface density and $C_p$ the specific heat at constant pressure. Since we assume the ocean surface current speed is zero, $\Delta \mathbf{u}_h = \mathbf{u}_h$, the velocity of the lowest model level. The potential temperature difference is $\Delta \theta = \theta_A - \theta_s$, where $\theta_s$ is the surface potential temperature. The specific humidity difference is $\Delta q = q_A - q_s(T_s)$, where $q_s(T_s)$ is the saturation specific humidity at the sea-surface temperature. 

The transfer coefficients are computed at a height $Z_A$ (lowest model level height) and are functions of the stability parameter $\zeta$,
\begin{align}
C_D &= \kappa^2\left[\ln\left(\frac{Z_A}{Z_{0m}}\right) - \psi_m\right]^{-2} \\
C_E &= \kappa^2\left[\ln\left(\frac{Z_A}{Z_{0m}}\right) - \psi_m\right]^{-1} 
			 \left[\ln\left(\frac{Z_A}{Z_{0e}}\right) - \psi_s\right]^{-1} \\
C_H &= \kappa^2\left[\ln\left(\frac{Z_A}{Z_{0m}}\right) - \psi_m\right]^{-1} 
			 \left[\ln\left(\frac{Z_A}{Z_{0h}}\right) - \psi_s\right]^{-1}			 
\end{align}
where $\kappa=0.4$ is von K\'arm\'an's constant and $z_{0m}$, $z_{0e}$, and $z_{0h}$ are the roughness lengths for momentum, evaporation, and heat, respectively, $\psi_m$ and $\psi_s$ are the integrated flux profiles for momentum and scalars, respectively.
Under stable conditions ($\zeta>0$), they are
\begin{equation}
\psi_m(\zeta) = \psi_s(\zeta) = -5\zeta
\end{equation}
For unstable conditions ($\zeta<0$), the flux profiles are
\begin{gather}
\psi_m(\zeta) = 2\ln[(1+x)/2] + \ln[(1+X^2)/2] - 2\tan^{-1}X + \pi/2,\\ 
\psi_s(\zeta) = 2\ln[(1+X^2)/2],\\
X = (1-16\zeta)^{1/4}
\end{gather} 
And the stability parameter is 
\begin{equation}
\zeta = \frac{\kappa g Z_A}{u^{*2}}\left(\frac{\theta^*}{\theta_v} + \frac{Q*}{\epsilon^{-1}+q_A}\right)
\end{equation}
where the virtual potential temperature is $\theta_v=\theta_A(1+\epsilon q_A)$, $q_A$ and $\theta_A$ are the lowest level atmospheric humidity and potential temperature, respectively. The turbulent velocity scales are
\begin{gather}
\tcboxmath{u^* = C_D^{1/2} | \Delta \mathbf{u}_h |}\\
Q^* = C_E |\Delta\mathbf{u}_h| \frac{\Delta q}{u*}\\
\theta^* = C_H |\Delta\mathbf{u}_h| \frac{\Delta \theta}{u^*}
\end{gather}


Over ocean, $ Z_{0e} = 9.5\times 10^{-5}\,\mathrm{m}$ under all conditions and $Z_{0h} = 2.2\times 10^{-9}\,\mathrm{m}$ for $\zeta>0$, and $Z_{0h} = 4.9\times 10^{-5}\,\mathrm{m}$ for $\zeta\leq0$. The momentum roughness length depends on the wind speed evaluated at 10\,m as\footnote{The exponent in equation 15 should be $-1/2$, instead of $-1$ (value in the CAM document).}
\begin{gather}
Z_{0m} = 10 \exp\left[-\kappa\left(c_4/U_{10} + c_5 + c_6 U_{10} \right)^{-1/2}\right]\\
U_{10} = U_A \left[1 + \frac{\sqrt{C_{10}^N}}{\kappa}\ln\left(\frac{Z_A}{10} - \psi_m  \right)   \right]
\end{gather}
where $c_4 = 0.0027\,\mathrm{m/s}$, $c_5 = 0.000142$, $c_6 = 0.0000764\,\mathrm{m/s}$, and the required drag coefficient at the 10-m height and neutral stability is
\begin{equation}
\tcboxmath{
C_{10D}^N = c_4 U_{10}^{-1} + c_5 + c_6 U_{10} }
\end{equation}

The key relationship in the iteration algorithm is that we need to update the drag coefficient in every step, and we need to relate the drag coefficient $C_D$ to the neutral condition, 10-m height drag coefficient $C_{10D}^N$. We can derive such a relationship based on equation 12 and the log law of wind profiles. Because
\begin{equation*}
\frac{1}{C_D^{1/2}} = \frac{u_A}{u^*} = \frac{1}{\kappa}\left[\ln\left(\frac{Z_A}{Z_{0m}}\right) - \psi_m \right]\qquad \text{and}\qquad
\frac{1}{(C_{10D}^N)^{1/2}} = \frac{u_{10}}{u^*}= \frac{1}{\kappa}\ln\left(\frac{Z_{10}}{Z_{0m}}\right)
\end{equation*}
we have
\begin{equation}
\tcboxmath{
\frac{1}{C_D^{1/2}} - \frac{1}{ (C_{10D}^N)^{1/2}} = \frac{1}{\kappa}\left[ \ln\left(\frac{Z_A}{Z_{10}}\right) - \psi_m\right]
}
\end{equation}
Once $C_D^{1/2}$ is obtained after iterations, the turbulent velocity scale $u^*$ can be obtained from equation 12. Similarly, the transfer coefficients of water vapor and heat have the following relationship with $C_D^{1/2}$ and flux profiles,
\begin{gather}
\frac{C_D^{1/2}}{C_E} = \frac{1}{\kappa}\left[\ln\left(\frac{Z_A}{Z_{0e}}\right) - \psi_s  \right], \qquad\text{and}\qquad 
\frac{(C_{10D}^N)^{1/2}}{C_{10E}^N} = \frac{1}{\kappa} \ln\left(\frac{Z_{10}}{Z_{0e}}\right);\\
\frac{C_D^{1/2}}{C_H} = \frac{1}{\kappa}\left[\ln\left(\frac{Z_A}{Z_{0h}}\right) - \psi_s  \right], \qquad\text{and}\qquad 
\frac{(C_{10D}^N)^{1/2}}{C_{10H}^N} = \frac{1}{\kappa} \ln\left(\frac{Z_{10}}{Z_{0h}}\right).\\
\end{gather}
Therefore, we have the following equations for iterations,
\begin{gather}
\tcboxmath{\frac{C_D^{1/2}}{C_E} - \frac{(C_{10D}^N)^{1/2}}{C_{10E}^N} = \frac{1}{\kappa}\left[\ln\left(\frac{Z_A}{Z_{10}}\right) - \psi_s  \right],} \\
\tcboxmath{\frac{C_D^{1/2}}{C_H} - \frac{(C_{10D}^N)^{1/2}}{C_{10H}^N} = \frac{1}{\kappa}\left[\ln\left(\frac{Z_A}{Z_{10}}\right) - \psi_s  \right].}
\end{gather}
in which
\begin{gather}
\tcboxmath{
C_{10E}^N (C_{10D}^N)^{-1/2} = c_1 = 0.0346
}\\
 \tcboxmath{C_{10H}^N (C_{10D}^N)^{-1/2} = 
 \begin{cases}
    c_2= 0.018\qquad \text{if\ } \zeta>0\\
    c_3=0.0327\qquad \text{if\ } \zeta\leq 0
 \end{cases}
 }
\end{gather}
The variables we can get and need to save in the code is $C_E C_D^{-1/2}$ and $C_H C_D^{-1/2}$, because according to equations 12--14, 
\begin{gather}
\tcboxmath{Q^* = C_E C_D^{-1/2} \Delta q}\\
\tcboxmath{\theta^* = C_H C_D^{-1/2} \Delta \theta}
\end{gather}

\subsection*{References}

Neale, R. B., Chen, C. C., Gettelman, A., Lauritzen, P. H., Park, S., Williamson, D. L., ... \& Taylor, M. A. (2010). Description of the NCAR community atmosphere model (CAM 5.0). \textit{NCAR Tech. Note NCAR/TN-486+ STR}, 1(1), 1-12.








\end{document}          
